from celery import shared_task
import requests
from .models import Scan, Test
from urllib.parse import urlparse

@shared_task
def WeakSSLTest(url):
    #get domain from url
    domain = urlparse(url).netloc
    print("domain nih",domain)
    
    data = {"query":"\n    mutation tlsChecker($input: ServerSecurityInput!) {\n  serverSecurityProtocols(input: $input) {\n    name\n    capability\n  }\n}\n    ","variables":{"input":{"domain":f"{url}"}}}
    r = requests.post("https://jarvis.cdn77.com/graphql", json=data)
    try:
        check_tls_1 = r.json()['data']['serverSecurityProtocols'][4]
        print(check_tls_1)

    except:
        print("gagal")